{% extends "inventory/collection/base.html" %}
{% load staticfiles %}
{% load inventory_extras %}

{% block head %}
<script src="{% static 'inventory/js/ol.js' %}"></script>
<link rel="stylesheet" href="{% static 'inventory/css/ol.css' %}">
{{ block.super }}
<style>

table {
  table-layout: fixed;
}
.rotated-table-inside {
  padding-right: 130px
}

.table-header-rotated {
  border-collapse: collapse;
}
/*.table-header-rotated td {
  width: 30px;
}*/
.table-header-rotated td {
  /*text-align: center;*/
  /*padding: 10px 5px;*/
  /*border: 1px solid #ccc;*/
}
.table-header-rotated th.rotate {
  height: 250px;
  white-space: nowrap;
  padding: 8px;
}
.table-header-rotated th.rotate > div {
  /*-webkit-transform: translate(25px, 51px) rotate(315deg);*/
          transform: translate(22px, 0px) rotate(300deg);
  width: 30px;
}
.table-header-rotated th.rotate > div > span {
  width: 220px;
  border-bottom: 1px solid #ddd;
  padding: 5px 10px;
}
.table-header-rotated th.row-header {
  /*padding: 0 10px;*/
  /*border-bottom: 1px solid #ccc;*/
}

.table-header-rotated thead th {
  border: none !important;
}

td {
  border-left: 1px solid #ddd;
  border-top: 1px solid #ddd;
  border-right: 1px solid #ddd;
  text-align: center;
}
</style>
{% endblock %}


{% block collection_header %}
{% with "alignment" as current %}
{{ block.super }}
{% endwith %}
{% endblock %}

{% block collection_content %}

<ul class="nav nav-tabs" role="tablist">
  <li role="presentation" class="{% if results == None %}active{% endif %}">
    <a href="#parameters" aria-controls="home" role="tab" data-toggle="tab">Parameters</a>
  </li>
  <li role="presentation" class="{% if results == None %}disabled{% else %}active{% endif %}">
    <a href="#results" aria-controls="profile" role="tab" {% if not results == None %}data-toggle="tab"{% endif %}>Results</a>
  </li>
</ul>

<form action="{% url 'inventory:collection:alignment' mission=collection.mission file_type=collection.file_type %}" method="post" class="form-horizontal">
  {% csrf_token %}

  <div class="tab-content">
    <div role="tabpanel" class="tab-pane {% if results == None %}active{% endif %}" id="parameters">
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-default">Perform Alignment Check</button>
        </div>
      </div>
      {% render_form pagination_form %}
      {% render_form alignment_form %}
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-default">Perform Alignment Check</button>
        </div>
      </div>
    </div>
    <div role="tabpanel" class="tab-pane {% if not results == None %}active{% endif %}" id="results">
      {% if not results %}
        No missalignments were detected.
      {% else %}
        <div class="rotated-table-inside">
          <table class="table table-striped table-condensed table-header-rotated">
           <colgroup>
              <col style="width: auto;">
            {% for location in results.keys %}
              <col style="width: 50px">
            {% endfor %}
          </colgroup>
            <thead>
              <tr>
                <th></th>
              {% for location in results.keys %}
                <th class="rotate"><div><span>{{ location }}</span></div></th>
              {% endfor %}
              </tr>
            </thead>
            <tbody>
            {% for record, missalignments in results.iter_missalignments %}
              <tr>
                <th>{{ record }}</th>
              {% for m in missalignments %}
                <!-- <td>{% if m %}{{ m.annotations.all.count }}{% endif %}
                </td> -->
                <td>
                  {% if m %}
                    <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
                  {% else %}
                    <span class="glyphicon glyphicon-remove text-danger" aria-hidden="true"></span>
                  {% endif %}
                </td>
              {% endfor %}
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>
</form>

{% endblock %}


{% block collection_footer %}
{% with "alignment" as current %}
{{ block.super }}
{% endwith %}
{% endblock %}